!function(r){"use strict";function o(r,o){o.otherwise("/home"),r.state("Home",{url:"/home",templateUrl:"/views/partial-home.html"}).state("Proforma",{url:"/Proforma",views:{"":{templateUrl:"/views/partial-proforma.html",controller:"ProformaController"}}}).state("History",{url:"/history",views:{"":{templateUrl:"/views/partial-history.html",controller:"HistoryController"}}})}var t=r.module("ProformaApp",["ngHandsontable","ui.router"]);t.config(o),o.$inject=["$stateProvider","$urlRouterProvider"]}(window.angular);
!function(r){"use strict";function e(r,e,n){function t(){var t=e.defer();return console.log("env var="+JSON.stringify(n.endpoint)),r.get(n.endpoint+"getmargins").then(function(r){t.resolve(r.data)},function(r){console.log("Error ="+r),t.reject(r)}),t.promise}function o(){var t=e.defer();return r.get(n.endpoint+"getmarginerrors").then(function(r){t.resolve(r.data)},function(r){console.log("Error ="+r),t.reject(r)}),t.promise}function i(){var t=e.defer();return r.get(n.endpoint+"getportfolio").then(function(r){t.resolve(r.data)},function(r){console.log("Error ="+r),t.reject(r)}),t.promise}function a(t){var o=e.defer();return r.post(n.endpoint+"addmarginhistory",t).then(function(r){o.resolve(r.data)},function(r){console.log("Error ="+r),o.reject(r)}),o.promise}function s(){var t=e.defer();return r.get(n.endpoint+"getmarginrunhistory").then(function(r){for(var e=[],n=r.data,o="",i=0;i<n.length;i++){var a=n[i]._id;n[i].rundate;o="";var s=0,g=n[i].inputparameters,u=n[i].marginsummary;if(g.length>0&&(g[0].hasOwnProperty("environment")&&(o=g[0].environment+"-"),g[0].hasOwnProperty("exchange_instrument")&&(o+=g[0].exchange_instrument+"-"),g[0].hasOwnProperty("margindate")&&(o+=g[0].margindate+" : $ ")),u.length>0)for(var c=0;c<u.length;c++)u[c].hasOwnProperty("IM")&&(s+=Number(u[c].IM,10));o+=s;var f=[{_id:a,hist_value:o}];e.push(f)}t.resolve(e)},function(r){console.log("Error ="+r),t.reject(r)}),t.promise}return{getMarginResult:t,getSamplePortfolios:i,getMarginErrors:o,addMarginHistory:a,getMarginRunHistroy:s}}var n=r.module("ProformaApp");n.factory("DataService",["$http","$q","appconfigs",e])}(window.angular);
!function(r){"use strict";function n(r){var n=this;n.hotTableSettings={colHeaders:!0,minSpareRows:1,sortIndicator:!0,columnSorting:!0,manualColumnResize:!0,formulas:!0,comments:!0,undo:!0,contextMenu:!0,contextMenuCopyPaste:{swfPath:"../bower_components/zeroclipboard/dist/ZeroClipboard.swf"}},n.hotTableminSpareRows=1,n.hotTablerowHeaders=!0,n.validateInputs=function(){if("undefined"==typeof n.inputparameters)return n.alertMsg="No input selected",!1;var r=n.inputparameters;return void 0===r.environment||0==r.environment.length?(n.alertMsg="Environment is missing",!1):void 0===r.exchange_instrument||0==r.exchange_instrument.length?(n.alertMsg="Exchange/Instrument is missing",!1):void 0===r.margindate||0==r.margindate?(n.alertMsg="Margin Date is missing",!1):!0},n.getPortfolio=function(){var t=n.validateInputs();return 0==t?void(n.showAlert=!0):(n.showAlert=!1,void r.getSamplePortfolios().then(function(r){n.showResults=!0,n.showResults=!1,n.marginsPortfolio=r},function(r){n.ErrorHandler(r)}))},n.getPortfolioResult=function(){r.getMarginResult().then(function(r){n.showResults=!0,n.marginResults=r.summary,n.marginDetailsResults=r.details,n.drawMarginResultChart(r.details),n.showCharts=!0},function(r){n.ErrorHandler(r)}),r.getMarginErrors().then(function(r){n.showResults=!0,n.marginErrors=r},function(r){n.ErrorHandler(r)})},n["import"]=function(){},n.reset=function(){console.log("in reset"),n.marginsPortfolio=null,n.marginResults=null,n.marginDetailsResults=null,n.marginErrors=null,n.showAlert=!1,n.showCharts=!1},n.addMarginHist=function(){var t={inputparameters:n.inputparameters,marginportfolio:n.marginsPortfolio,marginsummary:n.marginResults,marginerror:n.marginErrors,margindetail:n.marginDetailsResults};n.updateMode=!1,r.addMarginHistory(t).then(function(r){n.getMarginRunHist()},function(r){n.ErrorHandler(r)})},n.getMarginRunHist=function(){r.getMarginRunHistroy().then(function(r){n.marginsRunHistory=r},function(r){n.ErrorHandler(r)})},n.ErrorHandler=function(r){console.log("In ctrl.ErrorHandler"),n.ErrorSummary="Status: "+r.status+"; Error: "+r.statusText+"; Config: "+JSON.stringify(r.config),n.ErrorDetail=JSON.stringify(r.data),n.showAlert=!0,console.log("err="+n.ErrorSummary+n.ErrorDetail)},n.drawMarginResultChart=function(r){var n=dc.pieChart("#MarginSummaryPieChart"),t=dc.rowChart("#MarginDetailRowChart"),e=crossfilter(r),i=e.dimension(function(r){return r.Account}),o=i.group().reduceSum(function(r){return r.InitialMargins}),a=e.dimension(function(r){return r.Currency}),s=a.group().reduceSum(function(r){return r.InitialMargins});n.width(200).height(200).slicesCap(10).innerRadius(5).dimension(i).group(o),t.width(500).height(200).dimension(a).group(s),dc.renderAll()}}var t=r.module("ProformaApp");t.controller("ProformaController",["DataService",n])}(angular);